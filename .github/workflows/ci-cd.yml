name: CI

on: push

jobs:
  build:
	  runs-on: ubuntu-latest
	  steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: setup-node
        uses: actions/setup-node@v3
        with:
          node-version: "20"
      - name: install dependencies
        run: npm i
      - name: build
        run: npm run build
	deploy:
		if: github.ref == 'refs/heads/master'
		runs-on: ubuntu-latest
		steps:
			- name: checkout code
				uses: actions/checkout@v3
				with:
					sparse-checkout: |
						public
			- name: push to server
				uses: ssh-action@master
				with:
					host: ${{ secrets.SERVER_IP }}
					username: ${{ secrets.SERVER_USERNAME }}
					password: ${{ secrets.SERVER_PASSWORD }}
					script: cd ${{ secrets.PROJECT_PATH }} && git pull